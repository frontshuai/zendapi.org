<%
let targetVersion;
if ("mainEntry" == page.subtype || "versionEntry" == page.subtype) {
    targetVersion = config.zapi_version;
} else {
    let pagePath = page.canonical_path;
    let match = pagePath.match(/manual\/([.\d]*)/);
    targetVersion = match[1];
}
let versionKey = "manual/v"+targetVersion.replace(/\./g, "");
let catalog = clone(site.data[versionKey]);
let key = manual_key_from_path(page.path);
let baseUrl = "manual/"+targetVersion;

catalog.forEach(function(category){
    if (category.children && category.children.length != 0) {
        category.children.forEach(function(item){
            if (item.key == key) {
                item.isActive = true;
                category.isOpen = true;
                item.url = url_for(page.canonical_path);
            }
            item.url = url_for(baseUrl + "/"+ category.key + "/" + item.key + ".html");
        });
    }
});
if ("mainEntry" == page.subtype || "versionEntry" == page.subtype) {
    catalog.forEach(function(category){
        if (category.key == "prologue") {
            category.isOpen = true;
        }
    });
}
%>
window.MANUAL_CATALOG_DATA = <%- JSON.stringify(catalog)%>